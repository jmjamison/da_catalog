<!DOCTYPE html>
<!--[if IEMobile 7]><html class="no-js ie iem7" lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="no-js ie lt-ie9 lt-ie8" lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="no-js ie lt-ie9" lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><html class="no-js ie" lang="en" dir="ltr"><![endif]-->
<!--[if !IE]><!-->
<html class="js" dir="ltr" lang="en"><!--<![endif]--><head>
<!-- TemplateBeginEditable name="doctitle" -->
<title>Social Science Data Archive | UCLA Library</title>
<!-- TemplateEndEditable -->
<link rel="shortcut icon" href="https://www.library.ucla.edu/sites/all/themes/uclalib_omega/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="profile" href="http://www.w3.org/1999/xhtml/vocab">
<!-- the css for data archive's catalog -->
<link href="../_css/2col_leftNavLibraryInHouse.css" rel="stylesheet" type="text/css">
<!-- -->
  <link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_yowaKmroaK3erE-52t-m6wppkh-FyizMP_YSPcac9s4.css" media="all">
<link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_NXti8f1KG_3PtT4IIc0U3jDor0MbcpVCy5HvGkHBurk.css" media="screen">
<link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_sUM0nyo9pNGlCdw1gax7lwAzC91Cm8ozCNu0wgokPlA.css" media="all">
<link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_YIbCDBnX0Z7JXDuHxafQHQtSXISPFibkHk2DxLc1A-k.css" media="all">
<link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_28eC3-nofHM94fXGfcEbKDw6rxOILQLQUQ1n7jWokXA.css" media="all">
<link type="text/css" rel="stylesheet" href="../UCLA_SSDA/css_G1U0GbL4G9Ns4f81MGIYs0iiPZRdSM2TQN4zvD2VZKg.css" media="all">
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="https://www.library.ucla.edu/sites/default/files/css/css_xQJJNTpoUbrt7VMvqdSHpCab2KmnKq0up7WDdRliOt0.css" media="all" />
<![endif] -->

<script src="../UCLA_SSDA/ga.js" async type="text/javascript"></script>
<script src="../UCLA_SSDA/jquery_007.js"></script>
<script src="../UCLA_SSDA/jquery_004.js"></script>
<script src="../UCLA_SSDA/drupal.js"></script>
<script src="../UCLA_SSDA/no-js.js"></script>
<script src="../UCLA_SSDA/jquery_005.js"></script>
<script src="../UCLA_SSDA/tipsy.js"></script>
<script src="../UCLA_SSDA/jquery.js"></script>
<script src="../UCLA_SSDA/jquery_006.js"></script>
<script src="../UCLA_SSDA/jquery_003.js"></script>
<script src="../UCLA_SSDA/debounce.js"></script>
<script src="../UCLA_SSDA/displace.js"></script> 
<script src="../UCLA_SSDA/navbar-tableheader.js"></script>
<script src="../UCLA_SSDA/uclalib_opening_hours.js"></script>

<script src="../UCLA_SSDA/fancybox.js"></script>
<script src="../UCLA_SSDA/jquery_002.js"></script>
<script src="../UCLA_SSDA/linkitDialog.js"></script>
<script src="../UCLA_SSDA/tableheader.js"></script>
<script src="../UCLA_SSDA/uclalib_location.js"></script>
<script src="../UCLA_SSDA/panels_tabs.js"></script>
<script src="../UCLA_SSDA/googleanalytics.js"></script>
<!--<script>var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-32672693-1"]);_gaq.push(["_gat._anonymizeIp"]);// Sets the Google Analytics Site Speed sampling rate to 100%.
_gaq.push(['_setSiteSpeedSampleRate', 100]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();</script>
<script src="../UCLA_SSDA/site_alert.js"></script>
<script src="../UCLA_SSDA/uclalib-omega.js"></script> -->
<!--<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","fancybox":{"options":{"autoSize":0,"autoResize":0,"autoCenter":0,"fitToView":0,"mouseWheel":0,"loop":0,"openEffect":"elastic","closeEffect":"elastic","openOpacity":0,"closeOpacity":0},"helpers":{"title":{"position":"top"},"overlay_enabled":0,"overlay":null,"thumbs":{"width":"","height":"","position":"top"}},"callbacks":{"beforeShow":"fancybox_beforeshow","afterShow":"fancybox_aftershow"}},"tipsy":{"custom_selectors":[{"selector":".tipsy","options":{"fade":1,"gravity":"w","delayIn":0,"delayOut":0,"trigger":"hover","opacity":"0.8","offset":0,"html":0,"tooltip_content":{"source":"attribute","selector":"title"}}},{"selector":".views-tooltip","options":{"fade":1,"gravity":"autoNS","delayIn":0,"delayOut":0,"trigger":"hover","opacity":"0.8","offset":0,"html":1,"tooltip_content":{"source":"attribute","selector":"tooltip-content"}}}]},"locationNid":{"nid":"1381"},"panelsTabs":{"tabsID":["tabs-0-below_main_left"]},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip"},"tableHeaderOffset":"Drupal.navbar.height"});</script> -->
<style type="text/css">.fancybox-margin{margin-right:17px;}</style><script>try {  for(var lastpass_iter=0; lastpass_iter < document.forms.length; lastpass_iter++){    var lastpass_f = document.forms[lastpass_iter];    if(typeof(lastpass_f.lpsubmitorig)=="undefined"){      if (typeof(lastpass_f.submit) == "function") {        lastpass_f.lpsubmitorig = lastpass_f.submit;        lastpass_f.submit = function(){          var form = this;          try {            if (document.documentElement && 'createEvent' in document)            {              var forms = document.getElementsByTagName('form');              for (var i=0 ; i<forms.length ; ++i)                if (forms[i]==form)                {                  var element = document.createElement('lpformsubmitdataelement');                  element.setAttribute('formnum',i);                  element.setAttribute('from','submithook');                  document.documentElement.appendChild(element);                  var evt = document.createEvent('Events');                  evt.initEvent('lpformsubmit',true,false);                  element.dispatchEvent(evt);                  break;                }            }          } catch (e) {}          try {            form.lpsubmitorig();          } catch (e) {}        }      }    }  }} catch (e) {}</script>
<!-- TemplateBeginEditable name="head" -->
<!-- TemplateEndEditable -->
</head>
<body background="https://www.library.ucla.edu/sites/all/themes/uclalib_omega/images/mol-bg.jpg" class="html not-front not-logged-in page-node page-node- page-node-1381 node-type-location section-location">
  <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
    <div class="l-page has-no-sidebars">
  <div class="l-header-wrapper">
    <div class="l-header" role="banner">
        <div class="l-region l-region--branding">
    <div class="panel-pane pane-page-logo">
  
      
  
  <div class="pane-content">
    <a href="https://www.library.ucla.edu/" rel="home" id="logo" title="Home"><img src="../UCLA_SSDA/logo.png" alt="Home"></a>  </div>

  
  </div>
  </div>
        <div class="l-region l-region--header">
    <div class="panel-pane pane-block pane-system-user-menu">
  
      

  <div class="pane-content">
    <ul class="menu"><li class="first leaf"><a href="https://www.library.ucla.edu/hours">Hours</a></li>
<li class="last collapsed"><a href="https://www.library.ucla.edu/contact">Contact</a></li>
</ul>  </div>

  
  </div>
<div class="panel-pane pane-custom pane-1 pane-ask-a-librarian">
  
      
  
  <div class="pane-content">
    <p><a class="btn-ask" href="https://www.library.ucla.edu/support/research-help"><span class="icon-help"></span> Ask A Librarian</a></p>
  </div>

  
  </div>
<div class="panel-pane pane-search-form">
  
      
  
  <div class="pane-content">
        <div class="header-search-form-wrapper">
      <form class="header-search-form" action="https://www.library.ucla.edu/site-search" method="get" accept-charset="UTF-8">
        <div class="form-wrapper">
          <div class="form-item form-type-textfield">
            <input class="form-text" id="" name="search_query" size="15" maxlength="128" placeholder="Site Search" type="text">
          </div>
          <div class="form-actions">
            <input class="form-submit" id="submit" value="Go" type="submit">
          </div>
        </div>
      </form>
    </div>  </div>

  
  </div>
  </div>
    </div>
  </div>

  <div class="l-navigation-wrapper">
    <div id="menu" class="l-navigation">
        <div class="l-region l-region--navigation">
    <div class="panel-pane pane-page-primary-links">
  
      
  
  <div class="pane-content">
 <ul class="links primary-links">
 <li><a href="https://www.library.ucla.edu/" title=""><img src="../UCLA_SSDA/home_ucla_blue.png" width="23" height="19" border="5" hspace="0" vspace="5" align="absbottom"></a></li>
<li class="menu-2649"><a href="https://www.library.ucla.edu/search">Search</a></li>
<li class="menu-2090"><a href="https://www.library.ucla.edu/support">Research &amp; Teaching Support</a></li>
<li class="menu-721 active-trail"><a href="https://www.library.ucla.edu/locations" title="" class="active-trail">Locations</a></li>
<li class="menu-1072"><a href="https://www.library.ucla.edu/news-events" title="">News &amp; Events</a></li>
<li class="menu-2433 last"><a href="https://www.library.ucla.edu/use">Using the Library</a></li>
</ul>  </div>

  
  </div>
  </div>
    </div>
  </div>

  
  <div class="l-main-wrapper">
    <div class="l-main">

      <div class="l-content" role="main">
        <a name="main-content"></a>
        <div class="panel-pane pane-page-content">
  
      
  
  <div class="pane-content">
    <div class="sidebar-left-golden panel-sidebar-left-golden with-sidebar-left">

      <div class="l-region l-region--top">
      <div class="panel-pane pane-panels-mini pane-location-header">
  
      
  
  <div class="pane-content">
    <div class="panel-display panel-1col clearfix" id="mini-panel-location_header">
  <div class="panel-panel panel-col">
    <div><div class="panel-pane pane-node-title">
  
      
  
  <div class="pane-content">
    <h1><a href="https://www.library.ucla.edu/location/social-science-data-archive" class="active">Social Science Data Archive</a></h1>
  </div>

  
  </div>
<div class="panel-pane pane-views-panes pane-location-map-pin-map-pin-pane">
  
      
  
  <div class="pane-content">
    <div class="view view-location-map-pin view-id-location_map_pin view-display-id-map_pin_pane view-dom-id-2847b7be0a1a5ad32d587d13219c3b20">
        
  
  
      <div class="view-content">
        <div class="views-row views-row-1 views-row-odd views-row-first views-row-last">
      
  <div class="views-field views-field-field-location-map-link">      
<div class="field-content"><a href="http://maps.ucla.edu/campus/?z=14&amp;cpnt=-118.44163%2C34.07375"><img src="../UCLA_SSDA/map_icon_gray.png" width="12" height="16" align="absbottom"></a></div>  </div>  </div>
    </div>
  
  
  
  
  
  
</div>  </div>

  
  </div>
<div class="panel-pane pane-entity-field pane-node-field-address">
  
      
  
  <div class="pane-content">
    <div class="field field--name-field-address field--type-text-long field--label-hidden"><div class="field__items"><div class="field__item even">1120-H Rolfe Hall </div></div></div>  </div>

  
  </div>
<div class="panel-pane pane-entity-field pane-node-field-location-phone">
  
      
  
  <div class="pane-content">
    <div class="field field--name-field-location-phone field--type-phone field--label-hidden"><div class="field__items"><div class="field__item even">(310) 825-0716</div></div></div>  </div>

  
  </div>
<div class="panel-pane pane-entity-field pane-node-field-location-email">
  
      
  
  <div class="pane-content">
    <div class="field field--name-field-location-email field--type-email field--label-hidden"><div class="field__items"><div class="field__item even"><a href="mailto:libbie@g.ucla.edu">libbie@g.ucla.edu</a></div></div></div>  </div>

  
  </div>
<div class="panel-pane pane-entity-field pane-node-field-location-social-links">
  
      
  
  <div class="pane-content">
    <div class="field field--name-field-location-social-links field--type-social-links field--label-hidden"><div class="field__items"><div class="field__item even"><a href="https://www.facebook.com/uclassda"><img class="social-link social-link-facebook" src="../UCLA_SSDA/facebook-32-black.png"></a></div><div class="field__item odd"><a href="https://twitter.com/ucla_ssda"><img class="social-link social-link-twitter" src="../UCLA_SSDA/twitter-32-black.png"></a></div></div></div>  </div>

  
  </div>
</div>
  </div>
</div>
  </div>

  
  </div>
<div class="panel-pane pane-bean-living-library-gallery pane-bean-ssda-banner" >
  
      
  
  <div class="pane-content">
    <div class="entity entity-bean bean-living-library-gallery clearfix" class="entity entity-bean bean-living-library-gallery">

  <div class="content">
    <div class="field field--name-field-gallery-images field--type-image field--label-hidden"><div class="field__items"><div class="field__item even"><a href="https://www.library.ucla.edu/sites/default/files/styles/widescreen_large/public/archiveImage_1.jpg?itok=GQiYEfNE" title="" class="fancybox" data-fancybox-group="gallery-post-376"><img src="https://www.library.ucla.edu/sites/default/files/styles/widescreen_medium/public/archiveImage_1.jpg?itok=8xDDqAsy&amp;c=ac5efbef68b2a1fbfe2982c6782a5552" width="287" height="130" alt="" title="" /></a></div><div class="field__item odd"><a href="https://www.library.ucla.edu/sites/default/files/styles/widescreen_large/public/archiveImage_2.jpg?itok=SMSm3Mlo" title="" class="fancybox" data-fancybox-group="gallery-post-376"><img src="https://www.library.ucla.edu/sites/default/files/styles/widescreen_medium/public/archiveImage_2.jpg?itok=V0ZgT3Mi&amp;c=ac5efbef68b2a1fbfe2982c6782a5552" width="287" height="130" alt="" title="" /></a></div><div class="field__item even"><a href="https://www.library.ucla.edu/sites/default/files/styles/widescreen_large/public/archiveImage_3.jpg?itok=SORv93O7" title="" class="fancybox" data-fancybox-group="gallery-post-376"><img src="https://www.library.ucla.edu/sites/default/files/styles/widescreen_medium/public/archiveImage_3.jpg?itok=zSKVRbXU&amp;c=ac5efbef68b2a1fbfe2982c6782a5552" width="287" height="130" alt="" title="" /></a></div><div class="field__item odd"><a href="https://www.library.ucla.edu/sites/default/files/styles/widescreen_large/public/archiveImage_4.jpg?itok=aG_0K3ae" title="" class="fancybox" data-fancybox-group="gallery-post-376"><img src="https://www.library.ucla.edu/sites/default/files/styles/widescreen_medium/public/archiveImage_4.jpg?itok=vWokDwsT&amp;c=de4a411c37d7682ff0ad664ec16c3faa" width="287" height="130" alt="" title="" /></a></div></div></div>  </div>
</div>
  </div>

  
  </div>
    </div>
      <div class="l-region l-region--sidebar-left">
      <div class="panel-pane pane-open-now sidebar-tier-1">
  
      
  
  <div class="pane-content">
    <div class="open-now-pane"><span class="location-open-now">Open Now</span></div>  </div>

  
  </div>
<div class="panel-pane pane-block pane-menu-block-1 sidebar-tier-1">
  
      
  
  <?php include_once("../_includes/SSDA_LibrarySidePanel.php") ?>
  
<div class="panel-pane pane-bean-text-block pane-bean-ssda-schedule-appointment">
  
      
  
  <div class="pane-content">
    <div class="entity entity-bean bean-text-block clearfix">

  <div class="content">
    <div class="field field--name-field-text-block field--type-text-long field--label-hidden"><div class="field__items"><div class="field__item even"><p>Have questions about your research? <a href="mailto:libbie@g.ucla.edu?subject=Research%20questions">We can help?</a></p>
</div></div></div>  </div>
</div>
  </div>

  
  </div>
    </div>


  
  <div class="l-region l-region--main-column">
  
    
<!-- data archive  menubar - library in-house version  -->
<?php  
	include("../_includes/SSDA_menubar_libraryInHouse.php");  
//
// SSDA_menubar.php has the menu code for da_catalog, da_catalog_fielder(fielder collection) and 'archive reources'
//
?>
<!-- data archive google analytics tracking script -->
<?php include_once("../_includes/analyticstracking.php") ?>

  
          <div class="l-region l-region--main">
        <div class="panel-pane pane-node-body">
  

  
  <div class="pane-content">
  
  
    <div class="field field--name-body field--type-text-with-summary field--label-hidden"><div class="field__items"><div class="field__item even">



<!---------------------------------------------------------------------------------------------- -->
<!--ssda page code goes here -->
<!-- Scripts for title record menu bar -->
<script type="text/javascript" src="scripts/jquery-latest.js"></script> 
<script type="text/javascript" src="scripts/jquery.tablesorter.js"></script> 
<script type="text/javascript" id="js">$(document).ready(function() {
	// call the tablesorter plugin
	$("table").tablesorter({
		// sort on the first column and third column, order asc
		sortList: [[0,0],[2,0]]
	});
}); </script>

<!-- share-this script -->
<script type="text/javascript">var switchTo5x=true;</script><script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'605fb740-c736-4f2d-b087-bd8ffdb0078f'});</script>

<?php
 //error_reporting(E_ALL);
//ini_set('display_errors', 1);

	$currentHTTP = "http://data-archive.library.ucla.edu/da_catalog/";	
	//SSDA_menubar.php has the menu code for da_catalog, da_catalog_fielder(fielder collection) and 'archive reources'
	include("../_includes/SSDA_librarydatabase.php");  //SSDA_menubar.php has the menu code for da_catalog, da_catalog_fielder(fielder collection) and 'archive reources'
	// class for database connections
	include "../_classes/class.Database.php";
// Define configuration
// define info pulled from SSDA_librarydatabase.php
define("DB_HOST", $db_host);
define("DB_PORT", $db_port);
define("DB_USER", $db_username);
define("DB_PASS", $db_password);
define("DB_NAME", $db_name);
	
// should be adding "class.Database.php";	
//function __autoload($class_name) {
	// echo 'class.' . $class_name . '.php<br>';
	//include 'class.' . $class_name . '.php';
//}	
	
	// for the record: I had been using both title AND the study number, although I'm not displaying the studynumber -  to be sure I get the correct study
	// Last verion is only searching by studynumber.   151023
	
	$studynumber =  $_GET['studynumber']; 
	//$title =  $_GET['title']; 
	//echo $title . " " . $studynumber . "<br>";
	//echo $studynumber . "<br>";
	
	$queryBaseRecord = "SELECT title.*, picode.picode, picode.tisubsort, pifull.*, shcode.subjectcode, shfull.*, title.StudyNum, wwwlink_pi.wwwlink AS wwwlink_pi, wwwlink_pi.wwwtext AS wwwtext_pi, wwwlink_subject.wwwlink AS wwwlink_subject, wwwlink_subject.wwwtext AS wwwtext_subject, cite.cite, pifull.picode, shcode.subsort, picode.tisubsort FROM cite RIGHT JOIN ((((((title LEFT JOIN picode ON title.tisort = picode.tisort) LEFT JOIN pifull ON picode.picode = pifull.picode) LEFT JOIN shcode ON title.tisort = shcode.tisort) LEFT JOIN shfull ON shcode.subjectcode = shfull.subjectcode) LEFT JOIN wwwlink AS wwwlink_subject ON shfull.subjectcode = wwwlink_subject.subjectcode) LEFT JOIN wwwlink AS wwwlink_pi ON pifull.picode = wwwlink_pi.picode) ON cite.citenum = title.Cite WHERE title.StudyNum='" . $studynumber . "'";
	
		
	$queryDatasetRecords = "SELECT wwwlink.wwwlink, wwwlink.wwwtext, wwwlink.studynum, fileinfo.*, data_cite.cite AS datacite, fileinfo.Restricted AS restricted_file, fileinfo.StudyNum FROM cite AS data_cite RIGHT JOIN (wwwlink RIGHT JOIN fileinfo ON wwwlink.dtafile = fileinfo.DTAfile) ON data_cite.citenum = fileinfo.Cite WHERE fileinfo.StudyNum='" . $studynumber . "' AND (FileType = 'CD-Rom' OR FileType = 'SDA Online Analysis' OR FileType = 'Web Access') ORDER BY fileinfo.StudyPart";

	
	
	//echo $queryDatasetRecords . "<br>"; 
	 
	// check, if NOT set 
	if (!isset( $_GET['studynumber'])) {  //   remove $title test, this will eventually be phased out as redundent -  or !isset($_GET['title'])  - jmj120409
		echo "<span style='margin-left: 0; text-align: center; background-color: powderblue;'><a href='mobindex.html'>No citations selected. Return to catalog.</a></span><br>";
		die ("No citations selected.");
		
		}
	

	
	//echo $title<br>$studynumber<br>";
	
// class.Database.php  is the class to make PDO connections
// initialize new db connection instance
$db = new Database();	 
	
// prepare query
$db->prepareQuery($queryBaseRecord);   	
	
// bind value studynumber	
$db->bind(":studynumber",  $studynumber);	
	 
	 // PDO - execute the query
$result = $db->executeQuery();	
//$result = $db->resultset();  // execute the query
if (!$result) { 
		die ("Could not query the database: <br />"); 		
				}  // else {  echo "Successfully queried the database.<br>";   }  // for debugging
	
		//echo "<H2>$title&nbsp;&nbsp;($studynumber)</H2><br>";
	
		// complete record info
		$titleRecord = array();  // record - the title, sub# and restricted y/n
		// list of pi(s)
		
		$piList = array();		// list of pi(s)
		$piListFull = array();
		
		$subjectList = array(); // list of subjects
		//$fileInfo = array();		// file info -- move to part 2
		$usefulLinks = array();	// linklist
		//$linkListStudy = array();
		$linkListPI = array();
		$linkListSubject = array();
		
		$row_index = 0;   
		while  ($row = $db->getRow())  {     //   - 5 -
		// Non-PDO code ---------------------
		//while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) {
			
			$titleRecord[$row_index]["title"] = $row["Title"];
			$titleRecord[$row_index]["studyNum"] = $row[ "StudyNum" ];
			$titleRecord[$row_index]["restricted"] = $row[ "Restricted" ];
			$titleRecord[$row_index]["www"] = $row[ "WWW" ];
			$titleRecord[$row_index]["citation"] = $row[ "cite"];
			$titleRecord[$row_index]["dataverseDOI"] = $row[ "dataverseDOI"];
			//print_r($titleRecord);
			//
			//
			// links connected to the studynum, pi or subject
			// used to populate the "useful links" list
			if (!empty($row["wwwlink_studynum"])) { 
			$linkListStudy[$row_index] = "<a href='http://" . $row["wwwlink_studynum"] . "'>" . $row["wwwtext_studynum"]  . "</a>";
				}
			//
			// database wierdness note: in the wwwlink table the wwwtext field is often NOT filled in for the PI so pick up the pi directly
			//      First grab the pi - just incase the wwwtext field is empty
			//      Then check if the wwwtext field is really empty, if it isn't put in the wwwtext
			if (!empty($row["wwwlink_pi"])) {
			$linkListPI[$row_index] = "<a href='http://" . $row["wwwlink_pi"] . "'>" . $row["pi"]  . "</a>";
				}
			if (!empty($row["wwwtext_pi"])) {
			$linkListPI[$row_index] = "<a href='http://" . $row["wwwlink_pi"] . "'>" . $row["wwwtext_pi"]  . "</a>";
				}
			//
			//
			if (!empty($row["wwwlink_subject"])) {
			$linkListSubject[$row_index] = "<a href='http://" . $row["wwwlink_subject"] . "'>" . $row["wwwtext_subject"] . "</a>";
			}
			
			
			// old version
			$piList[$row_index] = $row[ "pi"];			
					
			$piListFull[$row_index]["pi_tisubsort"] = $row[ "tisubsort"];
			$piListFull[$row_index]["pi"]  = $row[ "pi"];
			
			//
			$subjectList[$row_index]["subsort"] = $row[ "subsort"]; 
			$subjectList[$row_index]["subject"] = $row[ "subject"]; 
			// 
			$picode[$row_index] = $row["picode"];
			//
			$subjectcode[$row_index] = $row["subjectcode"];
			
			$row_index++;
		}      
		
		
		// 150814jmj: SORT-REGULAR  for array-to-string error
		$titleRecord = array_unique($titleRecord, SORT_REGULAR); 
		sort($titleRecord);
		$titleRecordCount = count($titleRecord);  // just to check
		//echo "record: $titleRecordCount<br>";
		//echo "For debugging purposes :";
		//($titleRecord);
		echo "<br>";
				
		$row_index = 0;
		$title = $titleRecord[$row_index]["title"];  // there is only going to be one title
		//echo $title;
		$studyNum = $titleRecord[$row_index]["studyNum"];  // also only one study number per study
		$restricted = $titleRecord[$row_index]["restricted"]; // ristricted also won't change
		$www = $titleRecord[$row_index]["www"];
		$citation = $titleRecord[$row_index]["citation"];
		$dataverseDOI = $titleRecord[$row_index]["dataverseDOI"];
		
		
	 	//$piList = array_unique($piList);	// toss out duplicates
		//sort($piList);
		//print_r($piList);
		$piTotal = count($piList);  
		//echo "Total Principal Investigators: $piTotal<br>";
		
		
		//sort($piListFull);
		$piListFullCount = count($piListFull);
		$subjectListCount = count($subjectList);
		
		$piList_temp = array();
		
		for ($row_index = 0; $row_index < $piListFullCount; $row_index++) {
			
			$piList_temp[$row_index] =  "(" .  $piListFull[$row_index]["pi_tisubsort"]  .   ") " . $piListFull[$row_index]["pi"];
		}
		$piList_temp = array_unique($piList_temp);
		sort($piList_temp);
		//echo "<br>PiListFull_temp sorted: ";
		//cho "<br>";
		//print_r($piList_temp);
		
		
		
		//$subjectList = array_unique($subjectList);	// toss out duplicates
		//sort($subjectList);
		$subjectListCount = count($subjectList);
		$subjectList_temp = array();
		
		for ($row_index = 0; $row_index < $subjectListCount; $row_index++) {
			
			$indexterm = $subjectList[$row_index]["subject"];
			$indexterm = "<a href='da_catalog_titlesByIndexTerm.php?indexTerm=" . $indexterm . "'>" . $indexterm . "</a>";
			
			$subjectList_temp[$row_index] =  "(" .  $subjectList[$row_index]["subsort"]  .   ") " . $indexterm;
		}
		
		$subjectList_temp = array_unique($subjectList_temp);
		$subjectList_tempCount = count($subjectList_temp);
		sort($subjectList_temp);
		$subjectList_temp = array_unique($subjectList_temp);
		$subjectList_tempCount = count($subjectList_temp);
		sort($subjectList_temp);
		//echo "<br>PiListFull_temp sorted: ";
		//echo "<br>";
		//print_r($subjectList_temp);
		
			
			echo "<H3>" . $title . "  (" . $studynumber . ")</H3>";
		
		
			echo "<h5>Subjects:  <h4>";
			
			if ($subjectList_tempCount < 2) {  // only 1 pi/principal investigator  
				$row_index=0;
				echo $subjectList_temp[$row_index];
				echo "<br>";
			} elseif ($subjectList_tempCount > 1) { // there is more than one pi name to print out 
				for ($row_index = 0; $row_index < $subjectList_tempCount-1; $row_index++) {
					echo $subjectList_temp[$row_index] . ", ";
				}
				$lastSubject = $subjectList_temp[$subjectList_tempCount-1]; // last subject doesn't have a comma after it
				echo "$lastSubject";
			}
			echo "</h4></h5>";
			
			echo "<h5>Principal Investigator(s):&nbsp;<h4>";			
		 
			$piList_tempCount = count($piList_temp);
			if ($piList_tempCount < 2) {  // only 1 pi/principal investigator  
				$row_index=0;
				echo "$piList_temp[$row_index]</h4>";
			} elseif ($piList_tempCount > 1) { // there is more than one pi name to print out 
				for ($row_index = 0; $row_index < $piList_tempCount-1; $row_index++) {
				echo $piList_temp[$row_index] . ", ";
				}
				$lastPi = $piList_temp[$piList_tempCount-1]; // last pi doesn't have a comma after it
				echo "$lastPi";
			}
			
			
			echo "</h4></h5>";
			
			if ($citation <> "") {
				echo "<h5>Study Citation:&nbsp;</h5>" . $citation . "<br>";		
			}
			
			if ($dataverseDOI <> "") {
				echo "<h5>Download Here:&nbsp;<a href='" . $dataverseDOI . "'>" . $dataverseDOI . "</a></h5><br>";		
			}
			
			
			
			
	//--------------------------------------------------------------------------------------------
	//  Section for sharing links
	//  07/23/2011
	//
	//--------------------------------------------------------------------------------------------
	
	echo "<br>";
	
	echo "<div align='left' class='socialLinks' >";   
	
	echo "<span  class='st_twitter' ></span><span  class='st_facebook' ></span><span  class='st_email' ></span><span  class='st_sharethis' ></span>";
	
	echo "</div>";
	//--------------------------------------------------------------------------------------------
	//  now do the 2nd pass for datasets\
	//
	//
	//--------------------------------------------------------------------------------------------
	
	$fileInfo = array();		// file info
	
	
	//echo $query . "<br>";
	
	
	// prepare query
$db->prepareQuery($queryDatasetRecords);   	
// execute query


// bind value studynumber	
$db->bind(":studynumber",  $studynumber);	
	 
// execute query
$result = $db->executeQuery();	 
	
//$result = $db->resultset();  // execute the query
if (!$result) { 
		die ("Could not query the database: <br />"); 		
		}  // else {  echo "Successfully queried the database.<br>";   }  // for debugging

	
	
	$row_index = 0;   
	while ($row = $db->getRow())  {     //    
		// Non-PDO code ---------------------
		//while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) {
		$fileInfo[$row_index]["studypart"] = $row[ "StudyPart" ];
		$fileInfo[$row_index]["dsname"] = $row[ "Dsname" ];
		$fileInfo[$row_index]["filetype"] = $row[ "FileType" ];
		$fileInfo[$row_index]["note"] = $row[ "Note" ];
		//$fileInfo[$row_index]["reclen"] = $row[ "Reclen" ];
		//$fileInfo[$row_index]["filesize"] = $row[ "Fullsize" ];
		$fileInfo[$row_index]["dtafilenum"] = $row[ "DTAfile" ];
		//  12-17-09jmj added the reformated DTAfile field, now dtafilename
		$fileInfo[$row_index]["dtafilename"] = $row[ "dtafilename" ];
		$fileInfo[$row_index]["datacite"] = $row["datacite"];
		// links for the DATASETS
		// part of the file information 
		//$fileInfo[$row_index]["wwwlink"] = $row["wwwlink"];
		//$fileInfo[$row_index]["wwwtext"] = $row["wwwtext"];
		$fileInfo[$row_index]["wwwlink"] = $row["wwwlink"];
		$fileInfo[$row_index]["wwwtext"] = $row["wwwtext"];
		//$fileInfo[$row_index]["restricted_file"] = $row["fileinfo.Restricted"];  		
		$fileInfo[$row_index]["restricted_file"] = $row["restricted_file"];  
		// restricted on the dataset level
	
		$row_index++;
		}  
		
		//echo "<br>";
		//print_r($fileInfo);
		//echo "<br>";
	
		$fileInfoCount = count($fileInfo);
		//echo "file row count: " . $fileInfoCount . "<br>";

	
	echo "<br>";
	
	if(count($fileInfo) >= 1) {
	
				
			//--------------------------------------------------------
			//echo "<br>";
			//echo "For material available to download from the Data Archve:<br>";
			echo "Click on the <b>File Name</b> to download an individual file.<br>";
			echo "<div id='downloadallfiles' >";
			//  12-15-09jmj
			//  if there is 1 or more - >= 1 - datasets that can be downloaded from the DATA ARCHIVE 
			//  after the dataset list is written out, javascript at the end of this section will write in thelines
			//   commented out below 
		//	echo "To download an entire study choose: <A HREF='addfiles.php?file=&study=" . $studynumber . "&src=" . $studynumber . "'><img src='addall.gif'></a><br><br>";
       		echo "</div><br>";
			echo "<div>Click category headers to sort.<br>";
			echo "<table id='datasetListForDownload' class='tablesorter'>";
			echo "<thead><tr>";
			echo "<th width=100 >File Type</th>";
			echo "<th width=180 >Note</th>";
			echo "<th width=180 >Download Site</th>";	
			echo "<th >Dataset Citation</th>";
			echo "</tr></thead>";
			
	} 
			
		//  file info
		//print_r($fileInfo);
		
		//  INFO NOTE:  
		// ok, array_unique seems to not work too well with multi-dimensional arrays - see documentation on php site
		//  since the $dsname is the unique thingie here, just test on that below while looping through the array
		//$fileInfo = array_unique($fileInfo);
		//print_r($fileInfo);
		//echo "<br>";
		//sort($fileInfo);
		//print_r($fileInfo);
		//echo "<br>";
		//$fileInfoCount = count($fileInfo);  // just to check
		//echo "file information rows: $fileInfoCount<br>";
		$previousDtafilenum = null;
		
		// keep a count of data-archive-downloadable datasets, if >= 1 - at least 1 - write in the lines about Add All to the
		//     div section div id=downloadallfiles
		//     $da_downloadable is the counter variable
		//     use javascript script = -----
		//
	
			
		for ($row_index = 0; $row_index < $fileInfoCount; $row_index++)  {
			
		$studypart = $fileInfo[$row_index]["studypart"];
		$filetype = $fileInfo[$row_index]["filetype"];
		$note = $fileInfo[$row_index]["note"]; 
		$dsname = $fileInfo[$row_index]["dsname"];
		//if (empty($dsname)) { $dsname = ""; } // some ICPSR files don't use a dsname
		//$reclen = $fileInfo[$row_index]["reclen"];   
		//$filesize = $fileInfo[$row_index]["filesize"]; 
		$dtafilenum = $fileInfo[$row_index]["dtafilenum"];
		// 12-17-09jmj  added dtafilename, reformatedd DTAfile to dtafilename
		$dtafilename = $fileInfo[$row_index]["dtafilename"];
		//
		$datacite = $fileInfo[$row_index]["datacite"];
		$restricted_file = $fileInfo[$row_index]["restricted_file"];  // test for dataset level restricted file
		//  it is unlikely a base record will be unrestricted and a dataset restricted but this tests for that contingency
		
		$wwwtext = $fileInfo[$row_index]["wwwtext"];
		$wwwlink = $fileInfo[$row_index]["wwwlink"];
		
		
				
		//if ($dsname != $previousDSname) {
		if ($dtafilenum != $previousDtafilenum) {  
		
				echo "<TR>"; // beginning of the row
				
				// filetype
				if (stristr ($filetype, "ON CD-ROM"))	{  // datset on CD
					echo "<TD>" . $filetype . "</TD>";
					echo "<TD>$note: Please contact the Data Archives for data access assistance.</TD>";
					echo "<TD>&nbsp;</TD>"; 
					
				} elseif (stristr ($filetype, "SDA Online Analysis")) { // archive sda files (in-house); $filetype, $dsname, $note
				
					//$sda_onlineanalysis_link="http://zuma.sscnet.ucla.edu/issr/da/sdaweb/cgi-bin/hsda?harc";
					$sda_onlineanalysis_link="http://sda.sscnet.ucla.edu/cgi-bin/hsda?harc";
					echo "<TD>"  .  $filetype . "</TD>";  // which would be 'SDA online analysis' 
					echo "<TD>" . $note  . " ** SDA</TD>";     // something like the year, description, etc :  Codebook 1985-2001
					echo "<TD><a href='" . $sda_onlineanalysis_link . $dsname . "+" . $dsname . "'>" . $filetype . " (" .  $dsname .  ") <a></TD>";
					
				} elseif (stristr ($filetype, "Web Access")) { 
				
					if ((stristr($wwwtext, "ICPSR"))  OR (stristr ($note, "ICPSR")) OR (stristr ($filetype, "ICPSR"))) { 
					//  the most likely place to mark ICPSR is 1) the wwwtext field, 2) the note and 3) occasionally the filetype
					// this is an ICPSR dataset with a persistent link 
					//   reevaluate this section
					
						echo "<TD>"  .  $filetype . "</TD>";  // which would be 'Web Access' 
						
						echo "<TD>" . $note  . "</TD>";     // something like the year, description, etc :  Codebook 1985-2001
						
						//next, if the wwwlink has been left blank, build and fill in the persistant link
						// almost always this is the case where the ICPSRnnn number is in the wwwtext field and the wwwlink field is blank
						
						// download link section						
					 	if (empty($wwwlink)) { 
						
						//echo "wwwlink: " . $wwwlink . "<br>";
						
							$icpsrPersistentLink="http://dx.doi.org/10.3886/ICPSR0";
							//$icpsrStudynumber = substr($note, 5, strlen($note)-5);
							//$icpsrStudynumberLength = strlen($note)-5;
							$icpsrStudynumber = substr($wwwtext, 5, strlen($wwwtext)-5);
							$icpsrStudynumberLength = strlen($wwwtext)-5;
							echo "<TD><a href=" . $icpsrPersistentLink . $icpsrStudynumber .">" . $wwwtext  . "</h3><a></TD>";
							//------------------------------------------------------------------
							//    ELSE the link field -  wwwtext_link -  is NOT blank
							
								  } else  {// it's not blank
								  
								  //echo "<TD><a href=http://" . $wwwlink . "><h3>" . $wwwlink_text .  "</h3><a></TD>";
								 	//echo "wwwlink: " . $wwwlink . "<br>";
								  echo "<TD><a href='http://" . $wwwlink . "'>" . $wwwtext .  "<a></TD>";
								  }
						
						} else {  // any other site than ICPSR, no persistent link 
						
					
							echo "<TD>"  . $filetype . "</TD>";
							
							echo "<TD>" . $note . "<TD>";
							
							if (!empty($wwwlink)) { 
							//if (isset($wwwlink)) {
								echo " <a href=http://" . $wwwlink . " >" . $wwwtext  . "</a></TD>";
								//echo "<a href=http://" . $wwwlink . " >" . $note . " " . $wwwtext  . "</a></TD>";
							  		} else {
								  
								  	echo $wwwtext  . "  Please contact the Data Archives for data access assistance.</td>";
							 	 }
							  
							//echo "<TD>&nbsp;</TD>"; 
					
							}
				} 
				
				
				
				
				
			echo "<td align='left'>" . $datacite . "</td>";
				
				$previousDtafilenum = $dtafilenum;
				
				echo "</tr>";   // end of the row
				
				
				
				} // if-loop test for unique dsname
			
			
			
			} // for-loop for the entire file info array
			
			
			echo "</TABLE></DIV><br><br>";
			
			
			//-------------------------------------------------------------------------------------------------------------------
			
	// _destructor class closes connection
	// close the connection		
	//$PDO_connection = null;
	
	?>  <!--end container -->
<!---------------------------------------------------------------------------------------------- -->



</div></div></div>  </div>

  
  </div>
  
  
</div>  </div>

  
  </div>
</div><div class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide" id="tabs-0-below_main_left-2"><div class="panel-pane pane-bean-upcoming-events pane-bean-social-science-data-archive">
  
      
  
  <div class="pane-content">
    <div class="entity entity-bean bean-upcoming-events clearfix">

  <div class="content">
      </div>
</div>
  </div>

  
  </div>
</div></div>      </div>
  </div>
</div>
</div>

  
  </div>
      </div>

                </div>
  </div>

  <div class="l-colophon-wrapper">
    <div class="l-colophon" role="contentinfo">
        <div class="l-region l-region--colophon-first">
    <div class="panel-pane pane-bean-text-block pane-bean-colophon-about">
  
      
  
  <div class="pane-content">
    <div class="entity entity-bean bean-text-block clearfix">

  <div class="content">
    <div class="field field--name-field-text-block field--type-text-long field--label-hidden"><div class="field__items"><div class="field__item even">
    
   <img src="../_images/logo-colophon.png" alt="UCLA Library Logo" width="150" height="30">
   
<p>The mission of the UCLA Library is to provide access to and delivery 
of information resources to UCLA students, faculty, and staff in support
 of the research and instructional mission of the university. Relying on
 its highly skilled staff, the Library encourages innovation, 
capitalizes on appropriate technologies, forges effective partnerships 
and aggressively promotes excellence.</p>
</div></div></div>  </div>
</div>
  </div>

  
  </div>
  </div>
        <div class="l-region l-region--colophon-second">
    <div class="panel-pane pane-block pane-menu-menu-colophon-first">
  
      
  
  <div class="pane-content">
    <ul class="menu"><li class="first leaf"><a href="https://www.library.ucla.edu/about" title="">About UCLA Library</a></li>
<li class="leaf"><a href="https://www.library.ucla.edu/about/about-collections" title="">About the Collections</a></li>
<li class="last leaf"><a href="https://www.library.ucla.edu/about/giving-library" title="">Giving to UCLA Library</a></li>
</ul>  </div>

  
  </div>
  </div>
        <div class="l-region l-region--colophon-third">
    <div class="panel-pane pane-block pane-menu-menu-colophon-second">
  
      
  
  <div class="pane-content">
    <ul class="menu"><li class="first leaf"><a href="https://www.library.ucla.edu/about/employment-human-resources" title="">Employment</a></li>
<li class="leaf"><a href="http://www.ucla.edu/" title="">UCLA Homepage</a></li>
<li class="last leaf"><a href="https://www.library.ucla.edu/about/social-media-directory" title="">Social Media Directory</a></li>
</ul>  </div>

  
  </div>
  </div>
    </div>
  </div>

  <div class="l-footer-wrapper">
    <div class="l-footer" role="contentinfo">
        <div class="l-region l-region--footer">
    <div class="panel-pane pane-block pane-menu-menu-footer">
  
      
  
  <div class="pane-content">
    <ul class="menu"><li class="first last leaf"><span title="" class="footer-copyright nolink">2015 © UC Regents</span></li>
</ul>  </div>

  
  </div>
  </div>
    </div>
  </div>
</div>
  

</body></html>